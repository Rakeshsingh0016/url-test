<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>
</head>
<body>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
  import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAU_1WReKhyGqdWBJGaaN97rjzsyHcXHdU",
    authDomain: "url-short-450df.firebaseapp.com",
    databaseURL: "https://url-short-450df-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "url-short-450df",
    storageBucket: "url-short-450df.firebasestorage.app",
    messagingSenderId: "861547833606",
    appId: "1:861547833606:web:ff4f86c044c0b7e4e01687"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // get alias from URL path
  const alias = window.location.pathname.replace("/", "");  
  if (!alias || alias.length < 1) {
    document.body.innerHTML = "<h2>Invalid URL</h2>";
  } else {
    const urlRef = ref(db, "urls/" + alias);
    get(urlRef).then(snap => {
      if (snap.exists()) {
        const longUrl = snap.val().longUrl;
        window.location.href = longUrl; // fastest redirect
      } else {
        document.body.innerHTML = "<h2>404: Link not found</h2>";
      }
    });
  }

</script>

</body>
</html>
